<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>樹藝現場重量評估 - 專業版</title>
    <style>
        :root { --primary: #2e7d32; --bg: #f8f9fa; }
        body { font-family: sans-serif; background: var(--bg); padding: 15px; display: flex; flex-direction: column; align-items: center; }
        .container { width: 100%; max-width: 500px; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        h2 { text-align: center; color: var(--primary); margin-bottom: 20px; }
        .section { margin-bottom: 20px; }
        .label { font-weight: bold; margin-bottom: 8px; display: block; border-left: 4px solid var(--primary); padding-left: 8px; }
        .btn-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 8px; margin-bottom: 10px; }
        button { padding: 10px 5px; border: 1px solid #ddd; background: white; border-radius: 6px; cursor: pointer; font-size: 14px; }
        button.active { background: var(--primary); color: white; border-color: var(--primary); }
        select, input { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; box-sizing: border-box; }
        .source-box { background: #f0f4f0; padding: 12px; border-radius: 8px; margin-top: 10px; font-size: 13px; display: none; }
        .result-card { background: #e8f5e9; padding: 20px; border-radius: 12px; text-align: center; margin-top: 20px; border: 2px solid var(--primary); }
        .weight-value { font-size: 2.2rem; font-weight: 900; color: var(--primary); display: block; margin: 5px 0; }
        a { color: #1b5e20; text-decoration: underline; }
    </style>
</head>
<body>

<div class="container">
    <h2>樹藝現場重量評估</h2>

    <div class="section">
        <span class="label">1. 選擇樹種 (快速選單)</span>
        <div id="quick-grid" class="btn-grid"></div>
        
        <span class="label" style="margin-top:15px; border-left-color: #666;">其他常見行道樹/校園樹木</span>
        <select id="other-species" onchange="selectFromDropdown()">
            <option value="">-- 請選擇其他樹種 --</option>
        </select>

        <div id="source-info" class="source-box">
            <div><strong>推估密度：</strong> <span id="dens-val"></span> kg/m³</div>
            <div><strong>資料出處：</strong> <a id="source-link" href="#" target="_blank">讀取中...</a></div>
        </div>
    </div>

    <div class="section">
        <span class="label">2. 輸入直徑 (cm)</span>
        <div class="btn-grid">
            <button class="dia-btn" onclick="setDia(30, this)">30 cm</button>
            <button class="dia-btn" onclick="setDia(40, this)">40 cm</button>
            <button class="dia-btn" onclick="setDia(60, this)">60 cm</button>
            <button class="dia-btn" onclick="setDia(80, this)">80 cm</button>
        </div>
        <input type="number" id="custom-dia" placeholder="自填直徑 (cm)" oninput="clearActive('dia-btn'); calculate();">
    </div>

    <div class="section">
        <span class="label">3. 輸入長度 (m)</span>
        <div class="btn-grid">
            <button class="len-btn" onclick="setLen(0.5, this)">0.5 米</button>
            <button class="len-btn" onclick="setLen(1, this)">1 米</button>
            <button class="len-btn" onclick="setLen(2, this)">2 米</button>
        </div>
        <input type="number" id="custom-len" placeholder="自填長度 (m)" oninput="clearActive('len-btn'); calculate();">
    </div>

    <div class="result-card">
        <div>預估生材總重區間</div>
        <span class="weight-value" id="result-text">--- kg</span>
        <div id="calc-detail" style="font-size: 14px; color: #555;">請選擇樹種並輸入尺寸</div>
    </div>
</div>

<script>
    // 權威資料出處連結
    const REF_TFRI = "https://www.tfri.gov.tw/"; // 林試所官網
    const REF_MANUAL = "https://ws.tycg.gov.tw/001/Upload/115/relfile/13461/985280/20230323152102.pdf"; // 樹木植栽設計施工手冊

    // 樹種資料庫
    const quickSpecies = [
        { name: "相思樹", low: 1100, high: 1200, src: "林試所-國產材物理性質", url: REF_TFRI },
        { name: "樟樹", low: 900, high: 1000, src: "林試所-主要木材理學試驗", url: REF_TFRI },
        { name: "榕樹/菩提", low: 900, high: 1000, src: "都市樹木固碳能力推估", url: "https://tdr.lib.ntu.edu.tw/" },
        { name: "楓香", low: 850, high: 950, src: "林試所-平地造林樹種生長", url: REF_TFRI },
        { name: "肖楠/紅檜", low: 800, high: 950, src: "林試所-國產材資料庫", url: REF_TFRI },
        { name: "苦楝/桃花心木", low: 750, high: 850, src: "林試所-木材性質試驗", url: REF_TFRI },
        { name: "黑板樹", low: 600, high: 750, src: "桃園市樹木施工手冊", url: REF_MANUAL }
    ];

    const otherSpecies = [
        { name: "台灣欒樹", low: 1000, high: 1150, src: "林試所-平地造林重要樹種", url: REF_TFRI },
        { name: "阿勃勒", low: 850, high: 950, src: "都市林原生樹種現況展望", url: REF_TFRI },
        { name: "大花紫薇", low: 900, high: 1050, src: "環境部-核定樹種介紹", url: "https://freshair.moenv.gov.tw/" },
        { name: "小葉欖仁", low: 900, high: 1000, src: "林試所-小葉欖仁強度性質", url: REF_TFRI },
        { name: "黃連木", low: 1000, high: 1100, src: "林試所-國產材性質", url: REF_TFRI },
        { name: "光蠟樹", low: 900, high: 1000, src: "林試所-平地造林利用", url: REF_TFRI },
        { name: "水黃皮", low: 900, high: 1050, src: "環境部-空氣品質淨化區資料", url: "https://freshair.moenv.gov.tw/" },
        { name: "烏心石", low: 900, high: 1100, src: "林試所-平地造林重要樹種", url: REF_TFRI },
        { name: "茄苳", low: 900, high: 1100, src: "林試所-平地造林重要樹種", url: REF_TFRI },
        { name: "大葉山欖", low: 900, high: 1050, src: "都市樹木固碳資料庫", url: "https://tech.ardswc.gov.tw/" }
    ];

    let currentSpec = null;

    // 初始化介面
    const quickGrid = document.getElementById('quick-grid');
    quickSpecies.forEach(s => {
        const btn = document.createElement('button');
        btn.innerText = s.name;
        btn.onclick = () => {
            clearActive('spec-btn');
            document.getElementById('other-species').value = ""; // 清空下拉
            btn.classList.add('active');
            updateSpec(s);
        };
        btn.className = 'spec-btn';
        quickGrid.appendChild(btn);
    });

    const dropdown = document.getElementById('other-species');
    otherSpecies.forEach(s => {
        const opt = document.createElement('option');
        opt.value = s.name;
        opt.innerText = s.name;
        dropdown.appendChild(opt);
    });

    function selectFromDropdown() {
        const val = dropdown.value;
        if (!val) return;
        clearActive('spec-btn');
        const s = otherSpecies.find(x => x.name === val);
        updateSpec(s);
    }

    function updateSpec(s) {
        currentSpec = s;
        document.getElementById('source-info').style.display = 'block';
        document.getElementById('dens-val').innerText = `${s.low} ~ ${s.high}`;
        const link = document.getElementById('source-link');
        link.innerText = s.src;
        link.href = s.url;
        calculate();
    }

    function setDia(v, btn) { clearActive('dia-btn'); btn.classList.add('active'); document.getElementById('custom-dia').value = v; calculate(); }
    function setLen(v, btn) { clearActive('len-btn'); btn.classList.add('active'); document.getElementById('custom-len').value = v; calculate(); }
    function clearActive(c) { document.querySelectorAll('.'+c).forEach(b => b.classList.remove('active')); }

    function calculate() {
        const dia = parseFloat(document.getElementById('custom-dia').value);
        const len = parseFloat(document.getElementById('custom-len').value);
        if (!currentSpec || !dia || !len) return;

        const vol = Math.PI * Math.pow((dia/200), 2) * len;
        const wLow = Math.round(vol * currentSpec.low);
        const wHigh = Math.round(vol * currentSpec.high);

        document.getElementById('result-text').innerText = `${wLow} ~ ${wHigh} kg`;
        document.getElementById('calc-detail').innerText = `${currentSpec.name} | 材積約 ${vol.toFixed(3)} m³`;
    }
</script>
</body>
</html>
