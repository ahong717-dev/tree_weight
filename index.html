<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>樹藝重量評估 - 最終修復版</title>
    <style>
        :root { --primary: #2e7d32; --bg: #f4f7f4; }
        body { font-family: -apple-system, "微軟正黑體", sans-serif; background: var(--bg); padding: 15px; display: flex; justify-content: center; }
        .container { width: 100%; max-width: 500px; background: white; padding: 25px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        h2 { text-align: center; color: var(--primary); margin-top: 0; }
        
        .section { margin-bottom: 25px; }
        .label { font-weight: bold; margin-bottom: 12px; display: block; border-left: 5px solid var(--primary); padding-left: 10px; font-size: 1.1rem; }
        
        /* 按鈕樣式 */
        .btn-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 10px; margin-bottom: 12px; }
        button { 
            padding: 12px 5px; border: 1px solid #ddd; background: white; 
            border-radius: 10px; cursor: pointer; font-size: 15px; transition: all 0.2s;
            color: #333; outline: none;
        }
        button:hover { background: #f0f0f0; }
        /* 被選中時的強烈對比樣式 */
        button.active { background: var(--primary) !important; color: white !important; border-color: var(--primary) !important; font-weight: bold; box-shadow: 0 4px 8px rgba(46,125,50,0.3); }
        
        select, input { width: 100%; padding: 14px; border: 2px solid #eee; border-radius: 10px; font-size: 16px; box-sizing: border-box; transition: 0.3s; }
        input:focus { border-color: var(--primary); outline: none; background: #fff; }

        .source-box { background: #f9f9f9; padding: 12px; border-radius: 10px; margin-top: 10px; font-size: 13px; border: 1px solid #eee; line-height: 1.6; }
        
        /* 結果區域 */
        .result-card { background: #e8f5e9; padding: 25px; border-radius: 15px; text-align: center; margin-top: 10px; border: 2px solid var(--primary); }
        .weight-title { color: #555; font-weight: bold; margin-bottom: 5px; }
        .weight-value { font-size: 2.8rem; font-weight: 900; color: var(--primary); display: block; margin: 10px 0; }
        .calc-info { font-size: 14px; color: #1b5e20; background: rgba(255,255,255,0.5); padding: 8px; border-radius: 5px; margin-bottom: 10px; }
        .formula-box { font-size: 12px; color: #777; border-top: 1px solid rgba(0,0,0,0.05); pt: 10px; margin-top: 10px; line-height: 1.5; }
    </style>
</head>
<body>

<div class="container">
    <h2>樹藝現場重量評估</h2>

    <div class="section">
        <span class="label">1. 選擇樹種 (由重至輕)</span>
        <div class="btn-grid">
            <button type="button" class="spec-btn" onclick="updateSpec('相思樹', 1100, 1200, '林試所', this)">相思樹</button>
            <button type="button" class="spec-btn" onclick="updateSpec('樟樹', 900, 1000, '林試所', this)">樟樹</button>
            <button type="button" class="spec-btn" onclick="updateSpec('榕樹/菩提', 900, 1000, '國立台灣大學', this)">榕樹/菩提</button>
            <button type="button" class="spec-btn" onclick="updateSpec('楓香', 850, 950, '林試所', this)">楓香</button>
            <button type="button" class="spec-btn" onclick="updateSpec('肖楠/紅檜', 800, 950, '林試所', this)">肖楠/紅檜</button>
            <button type="button" class="spec-btn" onclick="updateSpec('苦楝', 750, 850, '林試所', this)">苦楝</button>
            <button type="button" class="spec-btn" onclick="updateSpec('黑板樹', 600, 750, '桃園市政府', this)">黑板樹</button>
        </div>
        
        <select id="other-species" onchange="dropdownChange()">
            <option value="">-- 或從下拉選單選擇其他 --</option>
            <option value="台灣欒樹,1000,1150,林試所">台灣欒樹 (約 1150 kg/m³)</option>
            <option value="烏心石,900,1100,林試所">烏心石 (約 1100 kg/m³)</option>
            <option value="茄苳,900,1100,林試所">茄苳 (約 1100 kg/m³)</option>
            <option value="大花紫薇,900,1050,環境部">大花紫薇 (約 1050 kg/m³)</option>
            <option value="小葉欖仁,900,1000,林試所">小葉欖仁 (約 1000 kg/m³)</option>
        </select>
    </div>

    <div class="section">
        <span class="label">2. 輸入直徑 (cm)</span>
        <div class="btn-grid">
            <button type="button" class="dia-btn" onclick="updateDia(30, this)">30 cm</button>
            <button type="button" class="dia-btn" onclick="updateDia(40, this)">40 cm</button>
            <button type="button" class="dia-btn" onclick="updateDia(60, this)">60 cm</button>
            <button type="button" class="dia-btn" onclick="updateDia(80, this)">80 cm</button>
        </div>
        <input type="number" id="inp-dia" placeholder="自填直徑 (cm)" oninput="syncDia()">
    </div>

    <div class="section">
        <span class="label">3. 輸入長度 (m)</span>
        <div class="btn-grid">
            <button type="button" class="len-btn" onclick="updateLen(0.5, this)">0.5 米</button>
            <button type="button" class="len-btn" onclick="updateLen(1, this)">1 米</button>
            <button type="button" class="len-btn" onclick="updateLen(2, this)">2 米</button>
        </div>
        <input type="number" id="inp-len" placeholder="自填長度 (m)" oninput="syncLen()">
    </div>

    <div class="result-card">
        <div class="weight-title">預估生材總重區間</div>
        <span class="weight-value" id="res-weight">--- kg</span>
        <div id="res-detail" class="calc-info">請完成上方選取</div>
        <div class="formula-box">
            <strong>帶入公式：</strong><br>
            體積 $V = \pi \times (\text{直徑}/200)^2 \times \text{長度}$<br>
            重量 = $V \times \text{密度}$
        </div>
    </div>
</div>

<script>
    let currentSpec = { name: '', low: 0, high: 0 };

    // --- 樹種處理 ---
    function updateSpec(name, low, high, src, btn) {
        // 切換按鈕狀態
        document.querySelectorAll('.spec-btn').forEach(b => b.classList.remove('active'));
        if(btn) btn.classList.add('active');
        document.getElementById('other-species').value = ""; // 清空下拉選單

        currentSpec = { name, low, high };
        runCalc();
    }

    function dropdownChange() {
        const val = document.getElementById('other-species').value;
        if(!val) return;
        document.querySelectorAll('.spec-btn').forEach(b => b.classList.remove('active'));
        
        const [name, low, high, src] = val.split(',');
        currentSpec = { name, low: parseInt(low), high: parseInt(high) };
        runCalc();
    }

    // --- 直徑處理 ---
    function updateDia(val, btn) {
        document.querySelectorAll('.dia-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById('inp-dia').value = val;
        runCalc();
    }
    function syncDia() {
        document.querySelectorAll('.dia-btn').forEach(b => b.classList.remove('active'));
        runCalc();
    }

    // --- 長度處理 ---
    function updateLen(val, btn) {
        document.querySelectorAll('.len-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById('inp-len').value = val;
        runCalc();
    }
    function syncLen() {
        document.querySelectorAll('.len-btn').forEach(b => b.classList.remove('active'));
        runCalc();
    }

    // --- 核心計算 ---
    function runCalc() {
        const d = parseFloat(document.getElementById('inp-dia').value);
        const l = parseFloat(document.getElementById('inp-len').value);
        const resWeight = document.getElementById('res-weight');
        const resDetail = document.getElementById('res-detail');

        // 檢查數據是否齊全
        if (!currentSpec.name || isNaN(d) || isNaN(l) || d <= 0 || l <= 0) {
            resWeight.innerText = "--- kg";
            resDetail.innerText = "請選擇樹種並輸入尺寸";
            return;
        }

        // 1. 計算體積 (半徑 r = d/200 單位公尺)
        const radius = d / 200;
        const volume = Math.PI * Math.pow(radius, 2) * l;

        // 2. 計算重量
        const wLow = Math.round(volume * currentSpec.low);
        const wHigh = Math.round(volume * currentSpec.high);

        // 3. 顯示結果
        resWeight.innerText = `${wLow} ~ ${wHigh} kg`;
        resDetail.innerHTML = `<strong>${currentSpec.name}</strong> | 體積約 <strong>${volume.toFixed(3)}</strong> m³`;
        
        console.log(`計算成功: 樹種=${currentSpec.name}, 體積=${volume}, 重量=${wLow}-${wHigh}`);
    }
</script>

</body>
</html>
